<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Channel Subscriber Counts</title>
</head>
<body>
  <h1>YouTube Channel Subscriber Counts</h1>
  <div id="loadingMessage">読込中...</div> <!-- 読み込み中のメッセージを表示する要素 -->
  <ol id="subscriberCounts"></ol> <!-- リスト表示のための <ol> 要素 -->


  <script>
    // APIキー
    const API_KEY = 'AIzaSyBGRZVcwJD7UgefK_2vh4d5hvecCzFs3eQ';

    // チャンネルIDと名前のマッピングを格納する変数
    let channelData = {};

    // チャンネルごとの登録者数を格納するオブジェクト
    const subscriberCounts = {};

    // メイン処理
    async function main() {
      try {
        document.getElementById('loadingMessage').style.display = 'block'; // 読み込み中メッセージを表示する

        // ファイルからチャンネルIDと名前の読み込み
        const response = await fetch('channel_data.json');
        channelData = await response.json();

        // 各チャンネルの登録者数を取得してオブジェクトに格納
        for (let channelId in channelData) {
          const subscriberCount = await getSubscriberCount(channelId);
          subscriberCounts[channelId] = subscriberCount;
        }

        // チャンネル登録者数でソート
        const sortedChannelIds = Object.keys(subscriberCounts).sort((a, b) => {
          return subscriberCounts[b] - subscriberCounts[a];
        });

        // ソートされたチャンネルごとに表示
        const subscriberCountsElement = document.getElementById('subscriberCounts');
        sortedChannelIds.forEach(channelId => {
          const p = document.createElement('p');
          const channelName = channelData[channelId];
          p.textContent = `${channelName}: ${subscriberCounts[channelId]} subscribers`;
          subscriberCountsElement.appendChild(p);
        });

        // 全ての処理が終了したら読み込み中メッセージを非表示にする
        document.getElementById('loadingMessage').style.display = 'none';
      } catch (error) {
        console.error('Error:', error);
      }
    }

    // チャンネルの登録者数を取得する関数
    async function getSubscriberCount(channelId) {
      const url = `https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${API_KEY}`;
      const response = await fetch(url);
      const data = await response.json();
      return parseInt(data.items[0].statistics.subscriberCount);
    }

    // メイン処理の実行
    main();
  </script>
</body>
</html>
