<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Channel Subscriber Counts</title>
</head>
<body>
  <h1>YouTube Channel Subscriber Counts</h1>
  <div id="loadingMessage">読込中...</div> <!-- 読み込み中のメッセージを表示する要素 -->
  <ol id="subscriberCounts"></ol> <!-- リスト表示のための <ol> 要素 -->


  <script>
    // APIキー
    const API_KEY = 'AIzaSyBGRZVcwJD7UgefK_2vh4d5hvecCzFs3eQ';

    // チャンネルIDと名前のマッピングを格納する変数
    let channelData = {};

    // チャンネルごとの登録者数を格納するオブジェクト
    const subscriberCounts = {};

    // チャンネルIDと名前をファイルから読み込む関数
    async function readChannelData() {
      try {
        // ファイルを読み込む
        const response = await fetch('channel_data.json');
        channelData = await response.json();
      } catch (error) {
        console.error('Error reading channel data:', error);
      }
    }

    // チャンネルごとの登録者数を取得し、オブジェクトに格納する関数
    async function fetchSubscriberCounts() {
      try {
        for (let channelId in channelData) {
          const count = await getSubscriberCount(channelId);
          subscriberCounts[channelId] = count;
        }
      } catch (error) {
        console.error('Error fetching subscriber counts:', error);
      }
    }

    // チャンネルの登録者数を取得する関数
    async function getSubscriberCount(channelId) {
      const url = `https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${API_KEY}`;
      const response = await fetch(url);
      const data = await response.json();
      return parseInt(data.items[0].statistics.subscriberCount);
    }

    // ランキングを表示する関数
    function displaySubscriberCounts() {
      const loadingMessage = document.getElementById('loadingMessage');
      loadingMessage.style.display = 'none'; // 読み込み中メッセージを非表示にする
      const subscriberCountsElement = document.getElementById('subscriberCounts');
      // チャンネル登録者数でソート
      const sortedChannelIds = Object.keys(subscriberCounts).sort((a, b) => {
        return subscriberCounts[b] - subscriberCounts[a];
      });
      // ソートされたチャンネルIDごとに表示
      sortedChannelIds.forEach(channelId => {
        const p = document.createElement('p');
        const channelName = channelData[channelId]; // チャンネルIDからチャンネル名を取得
        p.textContent = `${channelName}: ${subscriberCounts[channelId]} subscribers`;
        subscriberCountsElement.appendChild(p);
      });
    }

    // メイン処理
    async function main() {
      document.getElementById('loadingMessage').style.display = 'block'; // 読み込み中メッセージを表示する
      await readChannelData(); // チャンネルIDと名前の読み込み
      await fetchSubscriberCounts(); // 登録者数の取得
      displaySubscriberCounts(); // ランキングの表示
    }

    // メイン処理の実行
    main();
  </script>
</body>
</html>
